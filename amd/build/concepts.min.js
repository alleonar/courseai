/*! courseai_elt 2024-08-02 */
define(["jquery","core/templates","core/modal_factory","core/modal_events","core/str"],function(E,z,x,S,B){return{init:async()=>{let o=document.getElementById("dataanswerjs").getAttribute("data-answerjs");if(o){var e=await B.get_string("waitmodaltitle","local_courseai_elt"),i=await B.get_string("waitmodalbody","local_courseai_elt"),u=await B.get_string("waitmodalanimation","local_courseai_elt"),s=await B.get_string("confirmmodaltitle","local_courseai_elt"),c=await B.get_string("confirmmodalbody","local_courseai_elt"),d=await B.get_string("confirmmodalbutton","local_courseai_elt");let m=await B.get_string("modulename_page","local_courseai_elt"),_=await B.get_string("modulename_label","local_courseai_elt"),f=await B.get_string("modulename_forum","local_courseai_elt"),g=await B.get_string("modulename_quiz","local_courseai_elt"),b=await B.get_string("modulename_url","local_courseai_elt"),p=await B.get_string("modulename_glossary","local_courseai_elt"),l=await B.get_string("addnewactivity","local_courseai_elt"),n=await B.get_string("deletesection","local_courseai_elt"),r=await x.create({title:e,body:i,footer:u}),a=await x.create({type:x.types.SAVE_CANCEL,title:s,body:c}),t=(a.setButtonText("save",d),document.getElementsByClassName("add-section-button")[0].addEventListener("click",r=>{let a=r.target.id.split("_")[1];var e={id:"fgroup_id_sectiongroup_"+a,groupname:"sectiongroup_"+a,label:"Section "+a,element:{elements:[{input:!0,name:"sectiontitle_"+a,id:"sectiontitle_"+a,value:"",size:"30",type:"text",attributes:'placeholder="Enter your text"',frozen:!1,hardfrozen:!1,error:null},{div:!0,section:a},{button:!0,name:"addactivitybutton",id:a+"_0",value:l,attributes:"",frozen:!1,error:null},{removebutton:!0,id:a,value:n,attributes:"",frozen:!1,error:null}]}};let o=r.target.id;z.render("local_courseai_elt/sectiongroup",e).done(function(e,t){E("#"+o).before(e),z.runTemplateJS(t),a++,r.target.id="addSectBtn_"+a,v(),h(),y()}).fail(function(e){console.error("Erreur lors du rendu du template:",e)})}),[]);return new Promise((e,t)=>{o,e(o)}).then(e=>{return JSON.parse(e)}).then(d=>{var e=Object.keys(d).length;for(let c=1;c<=e;c++){let r=c-1;var t=d[r][0],a=d[r][1].length,t={id:"form_id",groupname:"sectiongroup_"+c,label:"Section "+c,element:{elements:[{input:!0,name:"sectiontitle_"+c,id:"sectiontitle_"+c,value:t,type:"text",attributes:"",frozen:!1,hardfrozen:!1,error:null},{div:!0,section:c},{button:!0,name:"addactivitybutton",id:c+"_"+a,value:l,attributes:"",frozen:!1,error:null},{removebutton:!0,id:c,value:n,attributes:"",frozen:!1,error:null}]}};let s=document.getElementById("sectionContainer").id;z.render("local_courseai_elt/sectiongroup",t).done(function(e,t){E("#"+s).append(e),z.runTemplateJS(t);var a=d[r][1];for(let e=1;e<=a.length;e++){var o=a[e-1],l=o[0],o=o[1],n="subsection_"+c+"_"+e,i="activity_"+c+"_"+e,u="fullsubsection_"+c+"_"+e;i={element:{id:"form_id",groupname:u,label:u,attributes:["w-100"],elements:[{select:!0,name:i,id:i,multiple:!1,size:null,frozen:!1,hardfrozen:!1,error:null,attributes:"",options:(u=o,[{text:_,value:"label",selected:"label"===u,disabled:!1,optionattributes:""},{text:m,value:"page",selected:"page"===u,disabled:!1,optionattributes:""},{text:p,value:"glossary",selected:"glossary"===u,disabled:!1,optionattributes:""},{text:g,value:"quiz",selected:"quiz"===u,disabled:!1,optionattributes:""},{text:f,value:"forum",selected:"forum"===u,disabled:!1,optionattributes:""},{text:b,value:"url",selected:"url"===u,disabled:!1,optionattributes:""}])},{input:!0,name:n,id:n,value:l,size:"50",type:"text",attributes:"",frozen:!1,hardfrozen:!1,error:null},{button:!0,name:"removebutton",id:"removeActBtn_"+c+"_"+e,value:'<i class="icon fa fa-trash fa-fw icon-class" aria-hidden="true"></i>',attributes:'class="remove-button btn btn_primary"',frozen:!1,error:null}]}};let r="activityContainer_"+c;z.render("local_courseai_elt/activitygroup",i).done(function(e,t){E("#"+r).append(e),z.runTemplateJS(t)}).fail(function(e){console.error(e)})}}).fail(function(e){console.error(e)})}}).then(()=>{var e=document.getElementById("sectionContainer");w(),new MutationObserver((e,t)=>{for(var r of e)h(),v(),y()}).observe(e,{attributes:!0,childList:!0,subtree:!0})}).catch(e=>{console.error("Error executing async; ",e)});function v(){var e=document.querySelectorAll(".remove-section-button");let t=null;e.forEach(e=>{e.addEventListener("click",e=>{t=e.target.closest(".form-group"),a.show(),a.getRoot().on(S.save,e=>{t&&(t.remove(),t=null)})})})}function y(){var e=document.getElementsByClassName("add-activity-button");Array.prototype.forEach.call(e,function(e){t.includes(e)||(t.push(e),e.addEventListener("click",function(r){let a,o;var e=r.target.id,t=(targetIdSplit=e.split("_"),a=targetIdSplit[1],o="0"===e[2]?"1":(o=parseInt(targetIdSplit[2])+1).toString(10),e="subsection_"+a+"_"+o,t="activity_"+a+"_"+o,{element:{id:"form_id",groupname:fullSubSectionName="fullsubsection_"+a+"_"+o,label:fullSubSectionName,attributes:["w-100"],elements:[{select:!0,name:t,id:t,multiple:!1,size:null,frozen:!1,hardfrozen:!1,error:null,attributes:"",options:[{text:_,value:"label",selected:!1,disabled:!1,optionattributes:""},{text:m,value:"page",selected:!0,disabled:!1,optionattributes:""},{text:p,value:"glossary",selected:!1,disabled:!1,optionattributes:""},{text:g,value:"quiz",selected:!1,disabled:!1,optionattributes:""},{text:f,value:"forum",selected:!1,disabled:!1,optionattributes:""},{text:b,value:"url",selected:!1,disabled:!1,optionattributes:""}]},{input:!0,name:e,id:e,value:"",size:"50",type:"text",attributes:'placeholder="Enter your text"',frozen:!1,hardfrozen:!1,error:null},{button:!0,name:"removebutton",id:"",value:'<i class="icon fa fa-trash fa-fw icon-class" aria-hidden="true"></i>',attributes:'class="remove-button btn btn_primary"',frozen:!1,error:null}]}});let l="activityContainer_"+a;z.render("local_courseai_elt/activitygroup",t).done(function(e,t){E("#"+l).append(e),z.runTemplateJS(t),r.target.id="addActBtn_"+a+"_"+o,h()}).fail(function(e){return e})}))})}function h(){var e=document.getElementsByClassName("remove-button");Array.prototype.forEach.call(e,function(e){e.addEventListener("click",e=>{(targetToDelete=e.target.closest(".form-group"))&&(targetToDelete.remove(),targetToDelete=null)})})}function w(){document.getElementById("savebutton").addEventListener("click",function(e){var t=function(){var e=document.getElementsByClassName("section-form");let a=[];function o(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return e.replace(/[&<>"'`=\/]/g,function(e){return t[e]})}return Array.prototype.forEach.call(e,function(e){var t=e.id.split("_"),e=o(e.value),t=document.getElementById("activityContainer_"+t[1]).querySelectorAll(".form-group");let r=[];Array.prototype.forEach.call(t,function(e){e=[o(e.querySelector(".activity-select").value),o(e.querySelector(".activity-form").value)];r.push(e)});t=[e,r];a.push(t)}),a}(),t=JSON.stringify(t);document.getElementById("coursejsoncontainer").value=t,document.getElementById("formvalid").value="true",document.getElementById("coursestructureform").submit(),r.show();{let e=document.getElementById("modalanim"),t=0;setInterval(()=>{t=(t+1)%360,e.style.transform=`rotate(${t}deg)`},10)}})}}else console.error("JSON is undefined")}}});